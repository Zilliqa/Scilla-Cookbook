"use strict";(self.webpackChunkdocu_scilla=self.webpackChunkdocu_scilla||[]).push([[9160],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),s=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=s(a),u=r,f=p["".concat(l,".").concat(u)]||p[u]||m[u]||i;return a?n.createElement(f,o(o({ref:t},d),{},{components:a})):n.createElement(f,o({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=p;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},968:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return d},default:function(){return p}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],c={tags:["Remote","State","Reads","RSR"]},l="Remote State Reads",s={unversionedId:"recipes/scilla-recipes/remoteread",id:"recipes/scilla-recipes/remoteread",isDocsHomePage:!1,title:"Remote State Reads",description:"A remote state read is the mechanism to read another contract state from any another contract. These remote fetches can be implemented in a number of ways.",source:"@site/docs/recipes/scilla-recipes/remoteread.md",sourceDirName:"recipes/scilla-recipes",slug:"/recipes/scilla-recipes/remoteread",permalink:"/recipes/scilla-recipes/remoteread",editUrl:"https://github.com/Zilliqa/Scilla-Cookbook/tree/master/docs/recipes/scilla-recipes/remoteread.md",tags:[{label:"Remote",permalink:"/tags/remote"},{label:"State",permalink:"/tags/state"},{label:"Reads",permalink:"/tags/reads"},{label:"RSR",permalink:"/tags/rsr"}],version:"current",frontMatter:{tags:["Remote","State","Reads","RSR"]},sidebar:"tutorialSidebar",previous:{title:"True Random VS Pseudo-Random",permalink:"/recipes/scilla-recipes/random"},next:{title:"Safe Mutiplication",permalink:"/recipes/scilla-recipes/safemutiply"}},d=[{value:"Address Subtyping",id:"address-subtyping",children:[]},{value:"Inline remote state read",id:"inline-remote-state-read",children:[]},{value:"Example",id:"example",children:[]},{value:"Example - Immutable Parameters",id:"example---immutable-parameters",children:[{value:"Remote State Read - Migration of Map",id:"remote-state-read---migration-of-map",children:[]}]},{value:"Further Reading",id:"further-reading",children:[]}],m={toc:d};function p(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"remote-state-reads"},"Remote State Reads"),(0,i.kt)("p",null,"A remote state read is the mechanism to read another contract state from any another contract. These remote fetches can be implemented in a number of ways."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Remote state reads only allow fetching of mutable fields, not immutable fields."))),(0,i.kt)("h2",{id:"address-subtyping"},"Address Subtyping"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ByStr20 with end"),": Refers to an address that is in use. An address is in use if it either of the conditions is fulfilled"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"balance greater than 0"),(0,i.kt)("li",{parentName:"ul"},"nonce of address greater than 0")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ByStr20 with contract end"),": Refers to a contract address"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ByStr20 with contract field f1 : t1, field f2 : t2, ... end"),": Refers to the address of a contract containing the mutable fields f1 of type t1, f2 of type t2, and so on. The contract in question may define more fields than the ones specified in the type, but the fields specified in the type must be defined in the contract."),(0,i.kt)("h2",{id:"inline-remote-state-read"},"Inline remote state read"),(0,i.kt)("p",null,"To perform a remote state read inline, the syntax  ",(0,i.kt)("inlineCode",{parentName:"p"},"x <- & c.f")," is used."),(0,i.kt)("p",null,"The type of c must be some contract address type declaring the field f. For instance, if c has the type ByStr20 with contract field paused : Bool end, then the value of the field paused at address c can be fetched using the statement ",(0,i.kt)("inlineCode",{parentName:"p"},"x <- & c.paused"),"."),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ocaml"},'scilla_version 0\n\ncontract RemoteRead\n()\n\n(* read a value from a contract that has a field value of type Uint128  *)\ntransition ReadValueFromSetGet(c: ByStr20 with contract field value: Uint128 end)\n  value <- & c.value;\n  ev = {_eventname : "ReadValueFromSetGet"; value: value};\n  event ev\nend\n\n(* read a value from a contract that has afield value of type Uint128   *)\n(* version #2: do not define the address type as a transition parameter *)\n(*              but only inside the transition: Address type cast       *)\ntransition ReadValueFromSetGet2(addr: ByStr20)\n  contract_opt <- &addr as ByStr20 with contract field value: Uint128 end;\n  match contract_opt with\n  | Some c =>\n    value <- &c.value;\n    ev = {_eventname : "ReadValueFromSetGet2"; value: value};\n    event ev\n  | None => \n    ev = {_eventname : "ReadValueFromSetGet2Failure"};\n    event ev\n  end\nend\n')),(0,i.kt)("h2",{id:"example---immutable-parameters"},"Example - Immutable Parameters"),(0,i.kt)("p",null,"Users must declare the remote contract mutable fields for which they are trying to access. If the contract has more mutable fields than the user requires to read, they can be omitted."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ocaml"},"(* Immutable parameter defined as 'An address on the network' which has fields value1, value2 *)\ncontract RemoteRead2\n(\n  remote_contract_addr: ByStr20 with contract\n    field value1: Uint128,\n    field value2: String\n  end \n)\n\n(* Remote read the contract at 'remote_contract_addr' and fetch the values into value1, value2 *)\ntransition RemoteStateRead()\n  value1 <-& remote_contract_addr.value1;\n  value2 <-& remote_contract_addr.value2;\n  ev = {_eventname : \"RemoteStateRead\"; value1: value1; value2: value2};\n  event ev\nend\n")),(0,i.kt)("h3",{id:"remote-state-read---migration-of-map"},"Remote State Read - Migration of Map"),(0,i.kt)("p",null,"This is an example how how migrate a map from contract A to contract B.\nBecause this implementation contains no batching functionaltiy, if the map becomes too large, the read and write operations will exceed the maximum amount of gas allowed for a transaction to consume, rendering this function effectively broken."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Can you improve the example to then batch on a selection of passed keys?"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ocaml"},'(* A : Old contract, has state read by contract(b) *)\ntransition ProxyReadFromMap(old_contract: ByStr20)\n  msg_to_new_contract = { \n    _tag: "ReadFromMap"; \n    _recipient: new_contract;\n    _amount: zero;\n    old_contract: old_contract \n  };\n  msgs = one_msg msg_to_new_contract;\n  send msgs\nend\n\n(* B : New contract, call this first with the old contract(a) *)\ntransition ReadFromMap (\n  old_contract: ByStr20 with contract \n    field map_a: Map ByStr20 Uint128\n  end\n)\n  temp_new_a <- & old_contract.map_a;\n  new_map_a := temp_new_a\nend\n')),(0,i.kt)("h2",{id:"further-reading"},"Further Reading"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/Zilliqa/scilla/pull/1014/files"},"Remote state read Implementation")))}p.isMDXComponent=!0}}]);