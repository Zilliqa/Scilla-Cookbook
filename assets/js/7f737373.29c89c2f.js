"use strict";(self.webpackChunkdocu_scilla=self.webpackChunkdocu_scilla||[]).push([[8590],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(t),m=i,h=u["".concat(c,".").concat(m)]||u[m]||d[m]||r;return t?a.createElement(h,o(o({ref:n},p),{},{components:t})):a.createElement(h,o({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=t[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},9039:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return u}});var a=t(7462),i=t(3366),r=(t(7294),t(3905)),o=["components"],s={sidebar_position:2},c="Calling a Contract",l={unversionedId:"tutorials/contract-interaction/incrementing-button-interaction/call-contract",id:"tutorials/contract-interaction/incrementing-button-interaction/call-contract",isDocsHomePage:!1,title:"Calling a Contract",description:"Review the javascript that defines callContract.js",source:"@site/docs/tutorials/contract-interaction/incrementing-button-interaction/call-contract.md",sourceDirName:"tutorials/contract-interaction/incrementing-button-interaction",slug:"/tutorials/contract-interaction/incrementing-button-interaction/call-contract",permalink:"/tutorials/contract-interaction/incrementing-button-interaction/call-contract",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/tutorials/contract-interaction/incrementing-button-interaction/call-contract.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/tutorials/contract-interaction/incrementing-button-interaction/introduction"},next:{title:"Contract State",permalink:"/tutorials/contract-interaction/incrementing-button-interaction/contract-state"}},p=[{value:"Setup of project",id:"setup-of-project",children:[]},{value:"Setup Zilliqa-JS",id:"setup-zilliqa-js",children:[]}],d={toc:p};function u(e){var n=e.components,t=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"calling-a-contract"},"Calling a Contract"),(0,r.kt)("p",null,"Review the javascript that defines ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Zilliqa/Zilliqa-JavaScript-Library-Examples/blob/master/node/callContract.js"},"callContract.js")),(0,r.kt)("h2",{id:"setup-of-project"},"Setup of project"),(0,r.kt)("p",null,"Open a new Visual Studio Code (VSC) window and create a new project."),(0,r.kt)("p",null,"Open a terminal window and initalise npm with ",(0,r.kt)("inlineCode",{parentName:"p"},"npm init")," and either press enter to skip and insert default values, or type the values, a file called ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," is created which will store our dependencies."),(0,r.kt)("p",null,"Now npm is setup, we can install the latest Zilliqa-JS, in the terminal type ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install @zilliqa-js/zilliqa"),"."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This is the recommended way for frontend javascript frameworks such as React, Angular, VueJS, etc"))),(0,r.kt)("h2",{id:"setup-zilliqa-js"},"Setup Zilliqa-JS"),(0,r.kt)("p",null,"Now we have all the dependencies required, we can start to write some Javascript. Create a new file called ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js"),"."),(0,r.kt)("p",null,"The require statements are pulling in the logic from Zilliqa-JS to use later in our code."),(0,r.kt)("p",null,"For example the ",(0,r.kt)("inlineCode",{parentName:"p"},"util")," class has methods dealing with BigNumbers and Zilliqa units. Similarly, the ",(0,r.kt)("inlineCode",{parentName:"p"},"crypto")," class has methods dealing with converting an Base16 to Bech32 and resolving a Bech32 address from a private key string."),(0,r.kt)("p",null,"The notable mention of this snippet is the newing up of a new Zilliqa Object with a network address as a parameter, the value is the network we want to connect to, in this example its ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-api")," aka testnet. To determine what network parameters you need for a specific envrionment, consult the ",(0,r.kt)("a",{parentName:"p",href:"https://dev.zilliqa.com/docs/apis/api-introduction"},"developer network documentation"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { BN, Long, bytes, units } = require('@zilliqa-js/util');\nconst { Zilliqa } = require('@zilliqa-js/zilliqa');\nconst {\n  toBech32Address,\n  getAddressFromPrivateKey,\n} = require('@zilliqa-js/crypto');\n\nconst zilliqa = new Zilliqa('https://dev-api.zilliqa.com');\n")),(0,r.kt)("p",null,"In the below snippet, we begin to create some of the configuration needed later to send a transaction. ",(0,r.kt)("inlineCode",{parentName:"p"},"VERSION")," will be used later in the transaction call. We then add a private key to the Zilliqa object so later we can execute against a specific address we own."),(0,r.kt)("p",null,"For our example, we ensure chainID and msgVersion are correct for testnet"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// these values can change depending on what network you are connecting on\nconst chainId = 333; // chainId of the developer testnet\nconst msgVersion = 1; // current msgVersion\nconst VERSION = bytes.pack(chainId, msgVersion);\n\n// use a dotenv file for storing private keys, do not commit this directly to your repo\nconst privateKey = '';\n// add the private key to the Zilliqa Object\nzilliqa.wallet.addByPrivateKey(privateKey);\n// resolve a Bech32 address from the private key\nconst address = getAddressFromPrivateKey(privateKey);\n")),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Never commit a private key to a repo, use a dotenv file instead, use .gitignore to ignore .env"))),(0,r.kt)("p",null,"In the below snippet, we begin to define an async function that will call the public transition. We define a custom gas price, and check this against the minimum price. We also define our testnet contract address."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function PressTheButton() {\n  try {\n    // Get ZIL Balance for our private key\n    const balance = await zilliqa.blockchain.getBalance(address);\n    // Get Minimum Gas Price from blockchain\n    const minGasPrice = await zilliqa.blockchain.getMinimumGasPrice();\n    // Create a custom gas price\n    const myGasPrice = units.toQa('2000', units.Units.Li); \n    // Checks if your gas price is less than the minimum gas price\n    const isGasSufficient = myGasPrice.gte(new BN(minGasPrice.result)); \n    // Point to your deployed contract on a specific network\n    const deployedContract = zilliqa.contracts.at('zil19vdpfzgzemny6qep82vax3u82wysgy9yqcjlln',);\n")),(0,r.kt)("p",null,"In the below example, we continue to define our async function. We now define a call to the previously defined contract transition with any associated vnames parameters. The below example shows a call to the ",(0,r.kt)("inlineCode",{parentName:"p"},"HelloWorld")," contract's transition ",(0,r.kt)("inlineCode",{parentName:"p"},"setHello")),(0,r.kt)("p",null,"Our example transition name is ",(0,r.kt)("inlineCode",{parentName:"p"},"PressTheButton")," that takes no additional vnames so we can omit the collection of vnames."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"}," const callTx = await deployedContract.callWithoutConfirm(\n      'setHello', // transition name\n      [\n        { // followed by an object of each vname\n          vname: 'msg', // vname  \n          type: 'String', // type\n          value: newMsg, //value\n        },\n      ],\n      {\n        // amount, gasPrice and gasLimit must be explicitly provided\n        version: VERSION, // packed chainID + msgVersion\n        amount: new BN(0), // ZIL to be sent\n        gasPrice: myGasPrice, // Gas Price\n        gasLimit: Long.fromNumber(8000), // Gas Limit\n      },\n      false, // Send to shard\n    );\n")),(0,r.kt)("p",null,"Our example would look like..."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"}," const callTx = await deployedContract.callWithoutConfirm(\n      'PressTheButton', // transition name\n      [], // no vnames\n      {\n        version: VERSION,\n        amount: new BN(0), \n        gasPrice: myGasPrice, \n        gasLimit: Long.fromNumber(8000), \n      },\n      false,\n    );\n")),(0,r.kt)("p",null,"We have now crafted our call to our contract. We now need to send this to an RPC node to be processed by the chain. Finally, we await the transitons confimation, if this is a success"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{2}","{2}":!0},"    console.log(`Waiting transaction be confirmed`);\n    const confirmedTxn = await callTx.confirm(callTx.id);\n\n    console.log(`The transaction status is:`);\n    console.log(confirmedTxn.receipt);\n    if (confirmedTxn.receipt.success === true) \n    {\n      console.log(`Button pressed by : ${address}`);\n    }\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nPressTheButton();\n")),(0,r.kt)("p",null,"Leaving us the full script for calling ",(0,r.kt)("inlineCode",{parentName:"p"},"MyFirstButton"),"'s transition called ",(0,r.kt)("inlineCode",{parentName:"p"},"PressTheButton")," on testnet."),(0,r.kt)("p",null,"The script can be called with the command ",(0,r.kt)("inlineCode",{parentName:"p"},"node <script_name>.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { BN, Long, bytes, units } = require('@zilliqa-js/util');\nconst { Zilliqa } = require('@zilliqa-js/zilliqa');\nconst {\n  toBech32Address,\n  getAddressFromPrivateKey,\n} = require('@zilliqa-js/crypto');\n\nconst zilliqa = new Zilliqa('https://dev-api.zilliqa.com');\n\nconst chainId = 333;\nconst msgVersion = 1; \nconst VERSION = bytes.pack(chainId, msgVersion);\n\nconst privateKey = '';\n\nzilliqa.wallet.addByPrivateKey(privateKey);\nconst address = getAddressFromPrivateKey(privateKey);\n\nasync function PressTheButton() {\n  try {\n    const balance = await zilliqa.blockchain.getBalance(address);\n    const minGasPrice = await zilliqa.blockchain.getMinimumGasPrice();\n    const myGasPrice = units.toQa('2000', units.Units.Li); \n    const isGasSufficient = myGasPrice.gte(new BN(minGasPrice.result)); \n    const deployedContract = zilliqa.contracts.at('zil19vdpfzgzemny6qep82vax3u82wysgy9yqcjlln',);\n\n    const callTx = await deployedContract.callWithoutConfirm(\n        'PressTheButton', // transition name\n        [], // no vnames\n        {\n        version: VERSION,\n        amount: new BN(0), \n        gasPrice: myGasPrice, \n        gasLimit: Long.fromNumber(8000), \n        },\n        false,\n    );\n\n    console.log(`Waiting transaction be confirmed`);\n    const confirmedTxn = await callTx.confirm(callTx.id);\n\n    console.log(`The transaction status is:`);\n    console.log(confirmedTxn.receipt);\n    if (confirmedTxn.receipt.success === true) \n    {\n      console.log(`Button pressed by : ${address}`);\n    }\n  } \n  catch (err) \n  {\n    console.log(err);\n  }\n}\nPressTheButton();\n")),(0,r.kt)("p",null,"The console, after waiting for the async call to be returned should reply with."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ node PressTheButton.js\nWaiting transaction be confirmed\nThe transaction status is:\n{\n  accepted: false,\n  cumulative_gas: 339,\n  epoch_num: '3436566',\n  success: true\n}\nButton pressed by : 0x428A2aA43456FE7fd2De66E48C1fBf372eC10eAE\n")))}u.isMDXComponent=!0}}]);